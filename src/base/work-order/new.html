<template>
    <require from="./items"></require>
    <h4>作业单</h4>
    <div class="row column-seperation">
        <div class="col-md-5">
            <div class="form-group">
                <div class="form-label">客户入库货物</div>
                <div class="controls">
                    <ak-drop-down-list class="form-control"
                                       k-option-label="请选择入库货物..."
                                       k-data-text-field="cargoName"
                                       k-data-value-field="id"
                                       k-value.two-way="workOrder.businessId"
                                       k-data-source.bind="cargoItemsSource"
                                       k-on-change.delegate="changeCargo()"
                                       k-on-close.delegate="validateWorkOrder('businessId')"
                                       style="width: 60%">
                    </ak-drop-down-list>
                    <input class="form-control" type="hidden" value.bind="workOrder.businessId & validate ">
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="form-group">
                <div class="form-label">作业单号</div>
                <div class="controls">
                    <input type="text" class="form-control" style="width: 60%"
                           value.bind="workOrder.workOrderNumber & validate">
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="form-group">
                <div class="form-label">作业日期</div>
                <div class="controls">
                    <input ak-datepicker="k-value.two-way : workOrder.workDate & validate" style="width: 60%"
                           type="text"
                           class="form-control">
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="form-group">
                <div class="form-label">车牌号</div>
                <div class="controls">
                    <ak-combobox class="form-control"
                                 k-placeholder="请选择/手动输入"
                                 k-data-text-field="plateNumber"
                                 k-data-value-field="plateNumber"
                                 k-value.two-way="workOrder.plateNumber"
                                 k-widget.two-way="selectedVehicle"
                                 k-data-source.bind="instockVehicleSource"
                                 k-on-select.delegate="onSelectPlateNumber($event.detail)"
                                 k-on-change.delegate="validateWorkOrder('plateNumber')"
                                 k-on-close.delegate="validateWorkOrder('plateNumber')"
                                 style="width: 60%;">
                    </ak-combobox>
                    <input class="form-control" type="hidden" value.bind="workOrder.plateNumber & validate">
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="form-group">
                <div class="form-label">司机名称</div>
                <div class="controls">
                    <ak-combobox class="form-control"
                                 k-placeholder="请选择/手动输入"
                                 k-data-text-field="driverName"
                                 k-data-value-field="driverName"
                                 k-value.two-way="workOrder.driverName"
                                 k-data-source.bind="instockVehicleSource"
                                 k-on-change.delegate="validateWorkOrder('driverName')"
                                 k-on-close.delegate="validateWorkOrder('driverName')"
                                 style="width: 60%;">
                    </ak-combobox>
                    <input class="form-control" type="hidden" value.bind="workOrder.driverName & validate">
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="form-group">
                <div class="form-label">身份证号</div>
                <div class="controls">
                    <ak-combobox class="form-control"
                                 k-placeholder="请选择/手动输入"
                                 k-data-text-field="driverIdentityNumber"
                                 k-data-value-field="driverIdentityNumber"
                                 k-value.two-way="workOrder.driverIdentityNumber"
                                 k-data-source.bind="instockVehicleSource"
                                 k-on-change.delegate="validateWorkOrder('driverIdentityNumber')"
                                 k-on-close.delegate="validateWorkOrder('driverIdentityNumber')"
                                 style="width: 60%;">
                        style="width: 60%;">
                    </ak-combobox>
                    <input class="form-control" type="hidden" value.bind="workOrder.driverIdentityNumber & validate">
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="form-group">
                <div class="form-label">电话</div>
                <div class="controls">
                    <ak-combobox class="form-control"
                                 k-placeholder="请选择/手动输入"
                                 k-data-text-field="phoneNumber"
                                 k-data-value-field="phoneNumber"
                                 k-value.two-way="workOrder.phoneNumber"
                                 k-data-source.bind="instockVehicleSource"
                                 k-on-change.delegate="validateWorkOrder('phoneNumber')"
                                 k-on-close.delegate="validateWorkOrder('phoneNumber')"
                                 style="width: 60%;">
                    </ak-combobox>
                    <input class="form-control" type="hidden" value.bind="workOrder.phoneNumber & validate">
                </div>
            </div>
        </div>
    </div>
    <h4>作业过程</h4>
    <div class="row column-seperation">
        <ak-grid k-data-source.bind="datasource"
                 k-pageable.bind="true"
                 k-editable="inline"
                 k-on-detail-init.delegate="detailInit($event.detail)"
                 k-widget.two-way="grid">

            <button click.trigger="add()" if.bind="workOrder.businessId">新增作业区域</button>

            <ak-col k-title="库区名称">
                <ak-template>
                    <ak-drop-down-list class="form-control"
                                       k-option-label="请选择..."
                                       k-data-text-field="name"
                                       k-data-value-field="id"
                                       k-value.two-way="warehouseId"
                                       k-data-source.bind="warehouseSource"
                                       style="width: 60%">
                    </ak-drop-down-list>
                </ak-template>
            </ak-col>
            <ak-col k-field="quantity" k-title="作业数量">
                <ak-template>
                    <input type="number" value.bind="quantity">
                </ak-template>
            </ak-col>
            <ak-col k-field="number" k-title="作业件数">
                <ak-template>
                    <input type="number" value.bind="number">
                </ak-template>
            </ak-col>
            <ak-col k-title="计量单位">
                <ak-template>
                    <ak-drop-down-list k-option-label="请选择..."
                                       k-value.two-way="unit"
                                       k-data-text-field="dictDataName"
                                       k-data-value-field="dictDataCode"
                                       k-data-source.bind="unitSource">
                    </ak-drop-down-list>
                </ak-template>
            </ak-col>
            <ak-col k-title="集装箱类型">
                <ak-template>
                    <ak-drop-down-list k-option-label="请选择..."
                                       k-value.two-way="containerType"
                                       k-data-text-field="dictDataName"
                                       k-data-value-field="dictDataCode"
                                       k-data-source.bind="containerTypeSource">
                    </ak-drop-down-list>
                </ak-template>
            </ak-col>
            <ak-col k-field="containerNumber" k-title="集装箱号">
                <ak-template>
                    <input type="text" value.bind="containerNumber">
                </ak-template>
            </ak-col>
            <ak-col k-field="remark" k-title="备注">
                <ak-template>
                    <input type="text" value.bind="remark">
                </ak-template>
            </ak-col>
            <ak-col>
                <ak-template>
                    <button class="btn btn-small" click.delegate="remove($this)">删除</button>
                </ak-template>
            </ak-col>
            <!--<ak-col k-command.bind="['destroy']" k-title="&nbsp;" width="250px"></ak-col>-->
            <ak-template for="detailTemplate">
                <area-items parent-uid.bind="$this.uid"></area-items>
            </ak-template>
        </ak-grid>
    </div>
    <button class="btn btn-primary" style="float: right" click.trigger="save()">保存</button>
    <button class="btn btn-white" style="float: right" click.trigger="cancel()">取消</button>
</template>