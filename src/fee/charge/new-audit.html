<template>
  <div class="grid simple">
    <div class="grid-body no-border">
      <form submit.delegate="save()">
        <div class="row column-seperation">
          <h4>基本信息</h4>
          <div class="col-md-3">
            <div class="form-group">
              <label class="form-label">代理商名称*</label>
              <span class="help"></span>
              <div class="controls">
                <ak-drop-down-list k-option-label="请选择" k-filter="contains" k-data-text-field="shortName" k-data-value-field="id" k-value.two-way="chargeInfo.agentId"
                  k-data-source.bind="agents" k-widget.two-way="agentWidget" k-on-close.delegate="validateProperty('agentId')">
                </ak-drop-down-list>
                <input class="form-control" type="hidden" value.bind="chargeInfo.agentId & validate ">
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="form-group">
              <label class="form-label">客户名称*</label>
              <span class="help"></span>
              <div class="controls">
                <ak-drop-down-list k-option-label="请选择" k-filter="contains" k-data-text-field="shortName" k-data-value-field="id" k-value.two-way="chargeInfo.customerId"
                  k-data-source.bind="customers" k-widget.two-way="customerWidget" k-on-change.delegate="customerChanged()"
                  k-on-close.delegate="validateProperty('customerId')">
                </ak-drop-down-list>
                <input class="form-control" type="hidden" value.bind="chargeInfo.customerId & validate ">
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="form-group">
              <label class="form-label">付款单位*</label>
              <span class="help"></span>
              <div class="controls">
                <input type="text" class="form-control" value.bind="chargeInfo.paymentUnit & validate" disabled.bind="disabled">
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="form-group">
              <label class="form-label">结算开始时间*</label>
              <span class="help"></span>
              <div class="controls">
                <input type="text" class="form-control" disabled.bind="disabled" k-on-change.delegate="startChange()"
                ak-datetimepicker="k-value.two-way : chargeInfo.chargeStartDate; k-format.bind:'yyyy-MM-dd HH:mm:ss'; k-widget.two-way: startDatePicker">
              </div>
            </div>
          </div>

          <div class="col-md-3">
            <div class="form-group">
              <label class="form-label">结算结束时间*</label>
              <span class="help"></span>
              <div class="controls">
                <input type="text" class="form-control" disabled.bind="disabled" k-on-change.delegate="endChange()"
                ak-datetimepicker="k-value.two-way : chargeInfo.chargeEndDate; k-format.bind:'yyyy-MM-dd HH:mm:ss'; k-widget.two-way: endDatePicker">
              </div>
            </div>
          </div>

          <div class="col-md-12">
            <div class="form-group">
              <label class="form-label">备注</label>
              <span class="help"></span>
              <div class="controls">
                <textarea type="text" class="form-control" value.bind="chargeInfo.remark & validate" disabled.bind="disabled"></textarea>
              </div>
            </div>
          </div>
        </div>
        <div class="row column-seperation">
          <h4>账单明细</h4>
          <div class="col-md-12">
            <span class="help"></span>
            <div class="controls right">
              <ak-grid k-data-source.bind="chargeAuditDataSource" k-editable.bind="true" k-toolbar.bind="['create']">
                <ak-col k-field="batchNumber" k-title="批次号">
                  <ak-template>
                    <input type="text" value.bind="batchNumber & validate" />
                  </ak-template>
                </ak-col>
                <ak-col k-field="billLadingNumber" k-title="提单">
                  <ak-template>
                    <input type="text" value.bind="billLadingNumber & validate" />
                  </ak-template>
                </ak-col>
                <ak-col k-field="containerQuantity" k-title="箱量">
                  <ak-template>
                    <input type="number" value.bind="containerQuantity & validate" />
                  </ak-template>
                </ak-col>
                <ak-col k-field="warehousingAmount" k-title="仓储费">
                  <ak-template>
                    <input type="number" value.bind="warehousingAmount & validate &toInt" />
                  </ak-template>
                </ak-col>
                <ak-col k-field="loadingAmount" k-title="装卸费">
                  <ak-template>
                    <input type="number" value.bind="loadingAmount & validate &toInt" />
                  </ak-template>
                </ak-col>
                <ak-col k-field="otherAmount" k-title="其他费用">
                  <ak-template>
                    <input type="number" value.bind="otherAmount & validate &toInt" />
                  </ak-template>
                </ak-col>
                <ak-col k-field="sumAmount" k-title="合计">
                  <ak-template>
                    <input type="number" value.bind="warehousingAmount + loadingAmount + otherAmount" readonly/>
                  </ak-template>
                </ak-col>
                <ak-col k-title="操作" k-command.bind="['destroy']"></ak-col>
              </ak-grid>
            </div>
          </div>
        </div>
        <div class="col-md-12">
          <div class="form-actions">
            <div class="pull-right">
              <button class="btn btn-primary" type="submit"><i class="icon-ok"></i> 保存</button>
              <a class="btn btn-white" click.trigger="cancel()">返回</a>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</template>